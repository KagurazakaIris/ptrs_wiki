---
import Layout from '../layouts/Layout.astro';

const canonicalHost = 'prts.wiki';
const canonicalOrigin = `https://${canonicalHost}`;
---

<Layout title="域名输入错误提示" description="你访问了错误域名，请前往 prts.wiki。">
  <main class="wrap">
    <section class="card" role="alert" aria-live="polite">
      <div class="badge">
        <span class="dot" aria-hidden="true"></span>
        域名输入错误提示
      </div>

      <h1>你来到了错误的网站：<span class="count" id="currentHost">（检测中）</span></h1>

      <p>
        正确网站是：<strong>{canonicalHost}</strong>。你可能把它打成了 <strong>ptrs.wiki</strong>。
      </p>

      <div class="info">
        <p>
          建议访问：
          <span class="count" id="targetUrlText">{canonicalOrigin}/</span>
        </p>
      </div>

      <div class="row">
        <a class="btn primary" id="goNow" href={canonicalOrigin} rel="noopener noreferrer">前往正确网站</a>
        <a class="btn" id="copy" href="#" role="button">复制正确链接</a>
        <a class="btn" id="github" href="#" role="button">前往 GitHub 仓库</a>
      </div>
    </section>

    <footer>
      这是一个提示页面，不提供任何内容服务。请以浏览器地址栏显示的域名为准。
    </footer>
  </main>

  <script>
    (() => {
      const canonicalOrigin = 'https://prts.wiki';
      const githubRepo = 'https://github.com/KagurazakaIris/ptrs_wiki';
      const currentHostEl = document.getElementById('currentHost');
      const goNowEl = document.getElementById('goNow');
      const goGithubRepo = document.getElementById('github');
      const copyEl = document.getElementById('copy');
      const targetUrlTextEl = document.getElementById('targetUrlText');

      const destination = `${canonicalOrigin}${location.pathname}${location.search}${location.hash}`;

      if (currentHostEl) currentHostEl.textContent = location.host || '（未知）';
      if (goNowEl) goNowEl.setAttribute('href', destination);
      if (goGithubRepo) goGithubRepo.setAttribute('href',githubRepo)
      if (targetUrlTextEl) targetUrlTextEl.textContent = destination;

      copyEl?.addEventListener('click', async (event) => {
        event.preventDefault();
        try {
          await navigator.clipboard.writeText(destination);
          copyEl.textContent = '已复制';
          setTimeout(() => {
            copyEl.textContent = '复制正确链接';
          }, 1200);
        } catch {
          alert(`复制失败，请手动复制链接：\n${destination}`);
        }
      });
    })();
  </script>
</Layout>
